<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../../CSS/usuario/login.css">
    <title>Login</title>
</head>

<body>
    <div class="m-auto mt-5 p-5"
        style="max-width: 520px;min-width: 300px;height: auto;background: #fff;border-radius: 12px;">

        <div class="row">
            <div class="col-12 m-auto">
                <h1 class="text-center display-4">Iniciar Sesion</h1>
                <form action="" class="myFormLogin" id="myFormLogin">
                    <div class="input-group mt-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><b style="font-size: 1.2rem;color: gray">@</b></span>
                        </div>
                        <input type="email" class="form-control shadow-none" placeholder="Correo Electronico"
                            name="txtCorreo" autocomplete="off">
                    </div>
                    <div class="input-group mt-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><b class="fas fa-lock"
                                    style="font-size: 1.3rem; padding: 2px 0;color: gray"></b></span>
                        </div>
                        <input type="password" class="form-control shadow-none" placeholder="Password"
                            name="txtPassword" autocomplete="off">
                    </div>
                    <div class="mt-2 d-flex align-items-center justify-content-between">
                        <small>Has olvidado tu contraseña?</small>
                        <span>Ya te registraste? <b class="openModal">Registrar</b></span>
                    </div>
                    <div class="mt-2">
                        <button type="submit" class="btn btn-primary">Login</button>
                        <button type="reset" class="btn btn-danger">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal pt-2">
            <div class="content m-auto mt-5 p-5 position-relative">
                <div class="col-12 m-auto">
                    <h1 class="text-center display-4">Registrar</h1>
                    <div style="position: absolute;top:20px;right:20px"><strong
                            style="font-size: 1.8rem;color: gray;cursor:pointer;" class="closeModal">&times;</strong>
                    </div>

                    <div class="alert alert-danger alert-dismissible fade show position-relative alert-error"
                        role="alert">
                        <strong>Error!</strong> Las contraseñas no coinciden.
                        <span class="close-alert-error">&times;</span>
                    </div>

                    <div class="alert alert-success alert-dismissible fade show position-relative alert-success"
                        role="alert">
                        <span>Cuenta registrada exitosamente</span>
                        <span class="close-alert-success">&times;</span>
                    </div>

                    <form action="" class="myFormRegister" id="myFormRegister">
                        <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="padding: 13px"><b class="fas fa-user"
                                        style="font-size: 1.2rem;color: gray;"></b></span>
                            </div>
                            <input type="text" class="form-control shadow-none" placeholder="Nombre" name="txtRegNombre"
                                autocomplete="off" required>
                            <input type="text" class="form-control shadow-none" placeholder="Apellido"
                                name="txtRegApellido" autocomplete="off" required>
                        </div>

                        <!-- <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="padding: 7px 10px"><b class="fa-solid fa-rectangle-list"
                                        style="font-size: 1.3rem; padding: 2px 0;color: gray"></b></span>
                            </div>
                            <input type="password" class="form-control shadow-none" placeholder="Documento Nacional de Identidad"
                                name="txtRegPassword" autocomplete="off" required>
                        </div> -->


                        <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="padding: 7px 12px"><b
                                        style="font-size: 1.2rem;color: gray">@</b></span>
                            </div>
                            <input type="email" class="form-control shadow-none" placeholder="Correo Electronico"
                                name="txtRegCorreo" autocomplete="off" required>
                        </div>
                        <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="padding: 7px 12px"><b class="fas fa-lock"
                                        style="font-size: 1.3rem; padding: 2px 0;color: gray"></b></span>
                            </div>
                            <input type="password" class="form-control shadow-none" placeholder="Password"
                                name="txtRegPassword" autocomplete="off" required>
                        </div>

                        <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="padding: 7px 12px"><b class="fas fa-unlock"
                                        style="font-size: 1.3rem; padding: 2px 0;color: gray"></b></span>
                            </div>
                            <input type="password" class="form-control shadow-none" placeholder="Confirmar Password"
                                name="txtRegPassword2" autocomplete="off" required>
                        </div>
                        <div class="mt-2">
                            <div>
                                <input class="form-check-input" type="checkbox" name="checkVer" id="checkVer">
                                <label for="checkVer" class="form-label">Ver Contraseña</label>
                            </div>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-success">Aceptar</button>
                            <button type="reset" class="btn btn-danger">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <script>
        // console.log(localStorage.admin_usuarios);
        sistemaLoginandRegister = () => {
            // RECOGER TODOS LOS ELEMENTOS
            const formLogin = document.forms["myFormLogin"];
            const formReg = document.forms["myFormRegister"];
            var opemModal = document.querySelector(".openModal");
            var closeModal = document.querySelector(".closeModal");
            var modal = document.querySelector(".modal");
            var showPass = document.querySelector("#checkVer");
            var alertSuccess = document.querySelector(".alert-success");
            var alertError = document.querySelector(".alert-error");
            // const usuarios_registrados = [];
            const usuarios_login = [];
            var contador_usuarios = 10;

            var a_usuarios = JSON.parse(localStorage.admin_usuarios);

            // FORMULARIO DE REGISTRO
            formReg.onsubmit = (e) => {
                e.preventDefault();
                let Rnombre = formReg.txtRegNombre.value;
                let Rapellido = formReg.txtRegApellido.value;
                let Rcorreo = formReg["txtRegCorreo"].value;
                let Rp1 = formReg["txtRegPassword"].value;
                let Rp2 = formReg["txtRegPassword2"].value;
                let Rimg = '../../IMG/userlogin.png';

                if (Rp1 == Rp2) {
                    contador_usuarios++;
                    alertSuccess.style.display = "block";
                    alertError.style.display = "none";
                    formReg.reset();

                    

                    a_usuarios.push({
                        ID: contador_usuarios,
                        nombre: Rnombre,
                        apellido: Rapellido,
                        correo: Rcorreo,
                        clave: Rp2,
                        DNI: "",            
                        IMGperfil: Rimg

                    })

                    localStorage.admin_usuarios = JSON.stringify(a_usuarios);
                }else{
                    alertError.style.display = "block";
                    alertSuccess.style.display = "none";
                }

                setTimeout(() => {
                    alertError.style.display = "none";
                    alertSuccess.style.display = "none";
                }, 2000);

                    // console.log(a_usuarios);
                    // console.log(Rnombre, Rapellido, Rcorreo, Rp1, Rp2, Rimg);

                    // user_reg.push({
                    //     ID: new_id,
                    //     nombre: Rnombre,
                    //     apellido: Rapellido,
                    //     correo: Rcorreo,
                    //     clave: Rp2,
                    //     IMGperfil: Rimg
                    // })



                    // console.log(localStorage.admin_usuarios);

                //     if (localStorage.admin_usuarios == null){
                //         contador_usuarios++;
                //         usuarios_registrados.push({
                //             ID: contador_usuarios,
                //             nombre: Rnombre,
                //             apellido: Rapellido,
                //             correo: Rcorreo,
                //             clave: Rp2,
                //             IMGperfil: Rimg
                //         })

                //         sessionStorage.usuarios_registrados = JSON.stringify(usuarios_registrados);
                //     }else{
                //         let user_reg = JSON.parse(sessionStorage.usuarios_registrados);
                //         if (usuarios_registrados.length == 0){
                //             let new_id = (user_reg.length+1);

                //             user_reg.push({
                //                 ID: new_id,
                //                 nombre: Rnombre,
                //                 apellido: Rapellido,
                //                 correo: Rcorreo,
                //                 clave: Rp2,
                //                 IMGperfil: Rimg
                //             })
                        
                //             sessionStorage.usuarios_registrados = JSON.stringify(user_reg);
                //         }else{
                //             contador_usuarios++;
                //             usuarios_registrados.push({
                //                 ID: contador_usuarios,
                //                 nombre: Rnombre,
                //                 apellido: Rapellido,
                //                 correo: Rcorreo,
                //                 clave: Rp2,
                //                 IMGperfil: Rimg
                //             })
                //             sessionStorage.usuarios_registrados = JSON.stringify(usuarios_registrados);
                //         }
                //     }    
                // } else {
                //     alertError.style.display = "block";
                //     alertSuccess.style.display = "none";
                
            }

            // FORMULARIO LOGIN
            formLogin.onsubmit = (e) => {
                e.preventDefault();

                let correo = formLogin["txtCorreo"].value;
                let password = formLogin["txtPassword"].value;

                // let user_registrados = JSON.parse(sessionStorage.usuarios_registrados);

                a_usuarios.forEach(e => {
                    if (e.correo == correo && e.clave == password) {
                        usuarios_login.push({
                            ID: e.ID,
                            nombre: e.nombre,
                            apellido: e.apellido,
                            correo: e.correo,
                            clave: e.clave,
                            DNI: "",
                            img: e.IMGperfil
                        })

                        // let user_login = JSON.stringify(usuarios_login);

                        sessionStorage.usuarios_login = JSON.stringify(usuarios_login);
                        location.href = "index.html";
                    }
                });
            }

            // ABRIR MODAL
            opemModal.onclick = () => {
                modal.style.display = "block";
            }

            // CERRAR MODAL
            closeModal.onclick = () => {
                modal.style.display = "none";
                formReg.reset();
            }

            // MOSTRAR PASSWORD
            showPass.onclick = () => {
                let p1 = formReg.txtRegPassword;
                let p2 = formReg["txtRegPassword2"];
                p1.type = (p1.type == "password") ? "text" : "password";
                p2.type = (p2.type == "password") ? "text" : "password";
            }

            // CERRAR ALERTA
            alertSuccess.onclick = () => {
                cerrarAlert(alertSuccess);
            }
            alertError.onclick = () => {
                cerrarAlert(alertError);
            }

            // FUNCION PARA CERRAR ALERTA
            cerrarAlert = (alerta) => {
                alerta.style.display = "none";
            }
        }

        window.onload = ()=>{
            sistemaLoginandRegister();
        }
    </script>
</body>
</html>